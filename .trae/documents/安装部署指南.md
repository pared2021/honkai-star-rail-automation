# 崩坏星穹铁道自动化助手 - 安装部署指南

## 目录

1. [环境要求](#环境要求)
2. [安装步骤](#安装步骤)
3. [配置说明](#配置说明)
4. [部署方式](#部署方式)
5. [验证安装](#验证安装)
6. [常见问题](#常见问题)

## 环境要求

### 系统要求

#### 最低配置
- **操作系统**: Windows 10 (64位) 或更高版本
- **处理器**: Intel Core i3 或 AMD 同等级别
- **内存**: 4GB RAM
- **存储空间**: 2GB 可用磁盘空间
- **显示器**: 1366x768 分辨率
- **网络**: 稳定的互联网连接

#### 推荐配置
- **操作系统**: Windows 11 (64位)
- **处理器**: Intel Core i5 或 AMD Ryzen 5
- **内存**: 8GB RAM 或更多
- **存储空间**: 5GB 可用磁盘空间（SSD推荐）
- **显示器**: 1920x1080 分辨率或更高
- **网络**: 高速稳定的互联网连接

### 软件依赖

#### 必需软件
1. **Python 3.9+**
   - 支持版本: Python 3.9, 3.10, 3.11, 3.12, 3.13
   - 推荐版本: Python 3.11 或 3.12
   - 下载地址: https://www.python.org/downloads/

2. **Git** (可选，用于源码管理)
   - 版本要求: Git 2.30+
   - 下载地址: https://git-scm.com/downloads

3. **崩坏星穹铁道游戏客户端**
   - 确保游戏已正确安装并可正常运行
   - 支持官方客户端和各大平台版本

#### 系统组件
- **Microsoft Visual C++ Redistributable**
  - 某些Python包可能需要
  - 通常随Windows更新自动安装

## 安装步骤

### 方式一：从源码安装（推荐）

#### 1. 获取源码

**使用Git克隆（推荐）**:
```bash
git clone <repository-url>
cd xingtie
```

**或下载压缩包**:
1. 从项目页面下载最新版本的源码压缩包
2. 解压到目标目录
3. 进入项目目录

#### 2. 创建虚拟环境（推荐）

```bash
# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# 或者使用PowerShell:
venv\Scripts\Activate.ps1
```

#### 3. 安装依赖包

```bash
# 升级pip到最新版本
python -m pip install --upgrade pip

# 安装项目依赖
pip install -r requirements.txt

# 安装开发依赖（可选，用于开发和测试）
pip install -r requirements-dev.txt
```

#### 4. 初始化配置

```bash
# 运行初始化脚本
python scripts/setup_dev_env.py
```

#### 5. 验证安装

```bash
# 运行程序
python main.py
```

### 方式二：使用预编译包（即将支持）

#### 1. 下载安装包
- 从发布页面下载适合您系统的安装包
- 选择对应的Windows版本（x64）

#### 2. 运行安装程序
- 双击安装包开始安装
- 按照安装向导完成安装
- 选择安装目录（默认：`C:\Program Files\XingTie`）

#### 3. 启动程序
- 从开始菜单启动程序
- 或双击桌面快捷方式

## 配置说明

### 基础配置

#### 1. 游戏路径配置

程序首次启动时需要配置游戏路径：

1. 启动程序后进入"游戏设置"标签页
2. 点击"浏览"按钮选择游戏安装目录
3. 确保选择的是游戏主程序所在目录
4. 点击"保存"按钮保存配置

**常见游戏路径**:
- Steam版本: `C:\Program Files (x86)\Steam\steamapps\common\Honkai Star Rail`
- Epic版本: `C:\Program Files\Epic Games\Star Rail`
- 官方版本: `C:\Program Files\miHoYo\Star Rail`

#### 2. 分辨率设置

1. 在"游戏设置"中选择游戏分辨率
2. 推荐使用1920x1080分辨率
3. 确保游戏实际运行分辨率与设置一致

#### 3. 自动化参数

在"自动化配置"标签页中调整以下参数：

- **操作延迟**: 500-1000ms（根据系统性能调整）
- **检测阈值**: 0.8（模板匹配相似度）
- **重试次数**: 3次
- **超时时间**: 30秒

### 高级配置

#### 1. 配置文件位置

主要配置文件位置：
- `config/default.ini` - 主配置文件
- `config/game_settings.json` - 游戏设置
- `config/automation_config.json` - 自动化配置
- `config/monitoring.yml` - 监控配置

#### 2. 日志配置

日志配置在 `src/config/logger.py` 中定义：
- 日志级别: INFO（可调整为DEBUG获取更详细信息）
- 日志文件: `logs/app.log`
- 日志轮转: 按日期自动轮转

#### 3. 数据库配置

程序使用SQLite数据库存储数据：
- 数据库文件: `data/app.db`
- 自动创建表结构
- 支持数据迁移

## 部署方式

### 开发环境部署

适用于开发和测试：

```bash
# 克隆项目
git clone <repository-url>
cd xingtie

# 创建虚拟环境
python -m venv venv
venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt
pip install -r requirements-dev.txt

# 运行开发环境检查
python scripts/pre_dev_check.py

# 启动程序
python main.py
```

### 生产环境部署

适用于日常使用：

```bash
# 克隆项目
git clone <repository-url>
cd xingtie

# 创建虚拟环境
python -m venv venv
venv\Scripts\activate

# 安装生产依赖
pip install -r requirements.txt

# 初始化环境
python scripts/setup_dev_env.py

# 启动程序
python main.py
```

### 打包部署（高级）

使用PyInstaller创建独立可执行文件：

```bash
# 安装PyInstaller
pip install pyinstaller

# 创建可执行文件
pyinstaller --onefile --windowed main.py

# 可执行文件位于 dist/ 目录
```

## 验证安装

### 1. 基础功能测试

```bash
# 运行基础测试
python -m pytest tests/test_basic.py -v

# 检查配置
python scripts/pre_dev_check.py
```

### 2. 界面测试

1. 启动程序: `python main.py`
2. 检查所有标签页是否正常显示
3. 测试游戏窗口检测功能
4. 验证日志输出正常

### 3. 功能测试

1. **游戏检测测试**
   - 启动崩坏星穹铁道游戏
   - 在程序中点击"检测游戏窗口"
   - 确认检测成功

2. **模板匹配测试**
   - 进入"自动化配置"
   - 点击"测试模板匹配"
   - 检查识别结果

3. **日志记录测试**
   - 执行任意操作
   - 检查日志文件是否正常记录
   - 验证日志格式正确

### 4. 性能测试

```bash
# 运行性能测试
python scripts/test_runner.py --performance

# 检查内存使用
python scripts/quality_gate.py --memory-check
```

## 常见问题

### 安装问题

#### Q: Python版本不兼容
**A**: 
- 确保使用Python 3.9或更高版本
- 使用 `python --version` 检查版本
- 如有多个Python版本，使用 `py -3.11` 指定版本

#### Q: 依赖包安装失败
**A**: 
```bash
# 升级pip
python -m pip install --upgrade pip

# 使用国内镜像源
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/

# 如果仍有问题，逐个安装
pip install PyQt6
pip install opencv-python
# ... 其他包
```

#### Q: 权限问题
**A**: 
- 以管理员权限运行命令提示符
- 或使用 `--user` 参数安装到用户目录
```bash
pip install --user -r requirements.txt
```

### 配置问题

#### Q: 游戏路径检测失败
**A**: 
1. 确认游戏已正确安装
2. 手动指定游戏可执行文件路径
3. 检查路径中是否包含中文字符
4. 确保有足够的文件访问权限

#### Q: 分辨率设置错误
**A**: 
1. 检查游戏实际运行分辨率
2. 在游戏设置中调整分辨率
3. 重启游戏和程序
4. 使用推荐的1920x1080分辨率

### 运行问题

#### Q: 程序启动缓慢
**A**: 
1. 检查系统资源使用情况
2. 关闭不必要的后台程序
3. 使用SSD硬盘
4. 增加系统内存

#### Q: 游戏窗口检测失败
**A**: 
1. 确保游戏窗口在前台
2. 检查游戏是否最小化
3. 尝试重新启动游戏
4. 调整窗口检测参数

### 更新问题

#### Q: 如何更新程序
**A**: 
```bash
# 使用Git更新
git pull origin main

# 更新依赖
pip install -r requirements.txt --upgrade

# 运行数据库迁移（如需要）
python src/database/migrate.py
```

#### Q: 配置文件兼容性
**A**: 
- 更新前备份配置文件
- 查看CHANGELOG了解配置变更
- 必要时重新配置

## 卸载说明

### 完全卸载

1. **删除程序文件**
   ```bash
   # 删除项目目录
   rmdir /s xingtie
   ```

2. **删除虚拟环境**
   ```bash
   # 如果使用了虚拟环境
   rmdir /s venv
   ```

3. **清理配置文件**
   - 删除用户配置目录中的相关文件
   - 清理注册表项（如有）

4. **清理数据文件**
   - 删除日志文件
   - 删除数据库文件
   - 删除截图和临时文件

### 保留数据卸载

如果希望保留配置和数据：

1. 备份以下目录：
   - `config/` - 配置文件
   - `data/` - 数据库和用户数据
   - `logs/` - 日志文件（可选）

2. 删除程序文件

3. 重新安装时恢复备份的数据

## 技术支持

如果在安装或部署过程中遇到问题：

1. **查看日志**: 检查 `logs/app.log` 中的错误信息
2. **运行诊断**: 使用 `python scripts/pre_dev_check.py` 检查环境
3. **查看文档**: 阅读相关文档和FAQ
4. **社区支持**: 在项目社区寻求帮助
5. **提交问题**: 在项目仓库提交详细的问题报告

---

**注意**: 请确保在安装和使用过程中遵守相关法律法规和游戏服务条款。