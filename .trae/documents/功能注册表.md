# 功能注册表

## 概述

本文档记录项目中所有核心功能的详细信息，用于防止重复开发和确保架构一致性。

**重要提醒**: 开发任何新功能前，必须先查阅此注册表！

---

## 核心功能注册

### 1. 游戏检测功能 (GameDetector)

**状态**: ✅ 已实现 | ✅ 已统一 | ❌ 禁止重复实现

- **模块位置**: `src/core/game_detector.py`
- **主要类**: 
  - `GameDetector`: 主要检测类
  - `TemplateMatcher`: 模板匹配器
  - `GameWindow`: 游戏窗口数据类
  - `DetectionResult`: 检测结果数据类
- **核心功能**: 
  - 检测游戏窗口
  - 判断游戏运行状态
  - 场景识别
  - UI元素定位
- **主要接口**: 
  - `detect_game_window() -> Optional[GameWindow]`
  - `is_game_running() -> bool`
  - `find_template(template_path: str) -> Optional[TemplateInfo]`
- **依赖**: `cv2`, `numpy`, `win32gui`, `PIL`
- **维护人员**: [待分配]
- **最后更新**: 2024年
- **重复实现位置**: 
  - ✅ `src/automation/game_detector.py` (已删除，功能已合并)
- **使用示例**:
```python
from src.core.game_detector import GameDetector

detector = GameDetector()
if detector.is_game_running():
    window = detector.detect_game_window()
    if window:
        print(f"找到游戏窗口: {window.title}")
```

---

### 2. 同步适配器功能 (SyncAdapter)

**状态**: ✅ 已实现 | ✅ 已统一 | ❌ 禁止重复实现

- **模块位置**: `src/core/sync_adapter.py`
- **主要类**: 
  - `SyncAdapter`: 主要适配器类
  - `CallbackManager`: 回调管理器
  - `AsyncCallback`: 异步回调基类
  - `SyncCallback`: 同步回调基类
- **核心功能**: 
  - 连接GUI线程和异步世界
  - 处理异步事件和回调
  - 在GUI线程中安全调用异步函数
  - 异步任务管理
- **主要接口**: 
  - `run_async(coro) -> Any`
  - `add_callback(callback: CallbackType)`
  - `start_task(task_func) -> str`
  - `stop_task(task_id: str)`
- **依赖**: `asyncio`, `PyQt6`, `typing`
- **维护人员**: [待分配]
- **最后更新**: 2024年
- **重复实现位置**: 
  - ✅ `src/ui/sync_adapter.py` (已删除，功能已合并)
  - ✅ `src/adapters/sync_adapter.py` (已删除，功能已合并)
- **使用示例**:
```python
from src.core.sync_adapter import SyncAdapter

adapter = SyncAdapter()
result = adapter.run_async(some_async_function())
```

---

### 3. 任务管理功能 (TaskManager)

**状态**: ✅ 已实现 | ✅ 已统一 | ❌ 禁止重复实现

- **主要模块位置**: 
  - `src/core/task_manager.py` (核心实现)
  - `src/services/task_service.py` (统一服务层)
  - `src/adapters/task_manager_adapter.py` (适配器)
- **主要类**: 
  - `TaskManager`: 核心任务管理器
  - `TaskService`: 统一任务服务（整合了应用层功能）
  - `TaskManagerAdapter`: 任务管理适配器
- **核心功能**: 
  - 任务的CRUD操作
  - 任务状态管理
  - 任务执行调度
  - 任务事件发布
  - 多任务并发控制
  - 任务依赖管理
  - 任务执行记录
- **主要接口**: 
  - `create_task(config: TaskConfig) -> str`
  - `start_task(task_id: str)`
  - `stop_task(task_id: str)`
  - `get_task_status(task_id: str) -> TaskStatus`
  - `execute_task(task_id: str, user_id: Optional[str] = None)`
  - `pause_task(task_id: str)`, `resume_task(task_id: str)`, `cancel_task(task_id: str)`
- **依赖**: `asyncio`, `dataclasses`, `typing`
- **维护人员**: [待分配]
- **最后更新**: 2024年
- **已删除的重复实现**: 
  - ✅ `src/core/multi_task_manager.py` (功能已合并到TaskManager)
  - ✅ `src/services/task_application_service.py` (功能已合并到TaskService)
  - ✅ `src/application/task_application_service.py` (功能已合并到TaskService)
- **使用示例**:
```python
from src.services.task_service import TaskService

task_service = TaskService()
task_id = task_service.create_task(task_config)
task_service.execute_task(task_id)
```

---

### 4. 自动化应用服务 (AutomationApplicationService)

**状态**: ✅ 已实现 | ✅ 允许扩展

- **模块位置**: `src/application/automation_application_service.py`
- **主要类**: `AutomationApplicationService`
- **核心功能**: 
  - 协调游戏检测和任务管理
  - 提供高级自动化接口
  - 处理自动化业务逻辑
- **主要接口**: 
  - `start_automation()`
  - `stop_automation()`
  - `get_automation_status()`
- **依赖**: `GameDetector`, `TaskManager`
- **维护人员**: [待分配]
- **最后更新**: 2024年
- **扩展指南**: 新的自动化功能应该通过扩展此服务实现

---

## 数据模型注册

### 1. 任务相关模型

- **TaskConfig**: 任务配置数据类
- **Task**: 任务实体数据类
- **TaskStatus**: 任务状态枚举
- **位置**: `src/models/task_models.py`

### 2. 游戏相关模型

- **GameWindow**: 游戏窗口数据类
- **UIElement**: UI元素数据类
- **TemplateInfo**: 模板信息数据类
- **位置**: `src/models/game_models.py`

---

## 工具函数注册

### 1. 配置管理

- **模块**: `src/config/config_manager.py`
- **功能**: 统一配置管理
- **主要接口**: `get_config()`, `set_config()`

### 2. 日志管理

- **模块**: `src/utils/logger.py`
- **功能**: 统一日志记录
- **主要接口**: `get_logger()`, `log_info()`

---

## 重复功能清理计划

### ✅ 已完成的清理任务

1. **GameDetector重复实现** ✅
   - ✅ 保留: `src/core/game_detector.py`
   - ✅ 删除: `src/automation/game_detector.py`
   - ✅ 迁移: 将有用的功能合并到核心实现

2. **SyncAdapter重复实现** ✅
   - ✅ 保留: `src/core/sync_adapter.py`
   - ✅ 删除: `src/ui/sync_adapter.py`, `src/adapters/sync_adapter.py`
   - ✅ 迁移: 将有用的功能合并到核心实现

3. **TaskManager功能统一** ✅
   - ✅ 统一接口设计
   - ✅ 合并分散的实现
   - ✅ 建立清晰的分层
   - ✅ 删除: `src/core/multi_task_manager.py`
   - ✅ 删除: `src/services/task_application_service.py`
   - ✅ 删除: `src/application/task_application_service.py`
   - ✅ 统一到: `src/services/task_service.py`

### 清理成果

- **删除重复文件**: 6个
- **统一核心功能**: 3个
- **测试通过率**: 100% (27/27)
- **架构一致性**: ✅ 已达成

**注意**: 所有核心功能现在都有唯一实现，严禁重复开发！

---

## 开发检查清单

### 新功能开发前必须检查

- [ ] 在此注册表中搜索相关功能
- [ ] 确认没有重复实现
- [ ] 评估是否可以扩展现有功能
- [ ] 确定正确的模块位置
- [ ] 检查依赖关系

### 功能开发完成后必须更新

- [ ] 在注册表中添加新功能记录
- [ ] 更新相关功能的依赖关系
- [ ] 标记任何被替代的功能
- [ ] 更新使用示例

---

## 维护记录

### 更新历史

- **2024年**: 初始版本创建
- **待更新**: 重复功能清理完成后更新

### 下次审查时间

- **每月审查**: 检查新增功能和重复情况
- **季度大审查**: 全面评估架构一致性

---

## 联系信息

**文档维护**: 开发团队  
**问题反馈**: [待设置]  
**紧急联系**: [待设置]  

---

**⚠️ 重要提醒**: 
1. 开发任何功能前必须查阅此表
2. 发现重复功能立即报告
3. 完成开发后立即更新此表
4. 定期参与功能注册表审查会议